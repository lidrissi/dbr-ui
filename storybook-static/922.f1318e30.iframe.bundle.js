"use strict";(self.webpackChunkdbr_ui=self.webpackChunkdbr_ui||[]).push([[922],{"./src/components/Widget/GenericWidget/GenericWidget.jsx":function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.r(__webpack_exports__);var _Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/objectSpread2.js"),_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/classCallCheck.js"),_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createClass.js"),_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_assertThisInitialized_js__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js"),_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_inherits_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/inherits.js"),_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_createSuper_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/createSuper.js"),_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),socket_io_client__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/socket.io-client/build/esm/index.js"),constants_resources__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./src/constants/resources.js"),_amcharts_amcharts4_themes_animated__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/@amcharts/amcharts4/themes/animated.js"),_amcharts_amcharts4_core__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/@amcharts/amcharts4/core.js"),_amcharts_amcharts4_charts__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("./node_modules/@amcharts/amcharts4/charts.js"),_amcharts_amcharts4_plugins_wordCloud__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__("./node_modules/@amcharts/amcharts4/plugins/wordCloud.js"),_amcharts_amcharts4_maps__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__("./node_modules/@amcharts/amcharts4/maps.js"),_amcharts_amcharts4_geodata_worldMoroccoLow__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__("./node_modules/@amcharts/amcharts4-geodata/worldMoroccoLow.js"),_amcharts_amcharts4_geodata_moroccoLow__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__("./node_modules/@amcharts/amcharts4-geodata/moroccoLow.js"),_services_NotificationService__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__("./src/services/NotificationService.js"),react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__("./node_modules/react/jsx-runtime.js");_amcharts_amcharts4_core__WEBPACK_IMPORTED_MODULE_5__.useTheme(_amcharts_amcharts4_themes_animated__WEBPACK_IMPORTED_MODULE_4__.Z),_amcharts_amcharts4_core__WEBPACK_IMPORTED_MODULE_5__.addLicense("ch-custom-attribution");var GenericWidget=function(_PureComponent){(0,_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_inherits_js__WEBPACK_IMPORTED_MODULE_13__.Z)(GenericWidget,_PureComponent);var _super=(0,_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_createSuper_js__WEBPACK_IMPORTED_MODULE_14__.Z)(GenericWidget);function GenericWidget(props){var _this;return(0,_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_classCallCheck_js__WEBPACK_IMPORTED_MODULE_15__.Z)(this,GenericWidget),_this=_super.call(this,props),_this.mappingParams=[],_this.lastAppParams=(0,_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_16__.Z)({},_services_NotificationService__WEBPACK_IMPORTED_MODULE_11__.B),_this.handleNotification=function(widgetNotification){JSON.stringify(_this.lastAppParams)!=JSON.stringify(widgetNotification.appParamsValue)&&(_this.props.onReceiveNotification(widgetNotification.appParamsValue),_this.lastAppParams=(0,_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_16__.Z)({},widgetNotification.appParamsValue))},_this.exportChart=function(type){_this.chart.exporting.export(type)},_this.initializeWidget=(0,_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_asyncToGenerator_js__WEBPACK_IMPORTED_MODULE_17__.Z)(_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().mark((function _callee(){var parsedConfig,initChart,_initChart,initChartParams;return _Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_regenerator_index_js__WEBPACK_IMPORTED_MODULE_0___default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:try{_this.setDashboardId();try{parsedConfig=_this.jsonParser(_this.props.widget.config),_this.props.widget.config=parsedConfig}catch(er){console.log(er)}_this.props.widget.config.hasOwnProperty("init")&&(initChart=eval(_this.props.widget.config.init),initChart(_this.props),_this.chart=_amcharts_amcharts4_core__WEBPACK_IMPORTED_MODULE_5__.createFromConfig(_this.props.widget.config,_this.props.widget._id,_this.props.widget.type)),_this.props.widget.config.hasOwnProperty("initChart")&&(_initChart=eval(_this.props.widget.config.initChart),initChartParams={chart:_this.chart,props:_this.props,am4core:_amcharts_amcharts4_core__WEBPACK_IMPORTED_MODULE_5__,am4charts:_amcharts_amcharts4_charts__WEBPACK_IMPORTED_MODULE_6__,worldMoroccoLow:_amcharts_amcharts4_geodata_worldMoroccoLow__WEBPACK_IMPORTED_MODULE_9__.Z,moroccoLow:_amcharts_amcharts4_geodata_moroccoLow__WEBPACK_IMPORTED_MODULE_10__.Z,am4maps:_amcharts_amcharts4_maps__WEBPACK_IMPORTED_MODULE_8__,am4plugins_wordCloud:_amcharts_amcharts4_plugins_wordCloud__WEBPACK_IMPORTED_MODULE_7__},_this.chart=_initChart(initChartParams)),_this.chart&&(_this.chart.dispatchEvent=_this.dispathWidgetEvent.bind((0,_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_assertThisInitialized_js__WEBPACK_IMPORTED_MODULE_18__.Z)(_this)))}catch(error){console.log(error)}case 1:case"end":return _context.stop()}}),_callee)}))),_this.mappingParams=_this.props.widget.mappingParams,_this.subscription=_services_NotificationService__WEBPACK_IMPORTED_MODULE_11__.O.getNotification().subscribe((function(widgetNotification){_this.handleNotification(widgetNotification)})),_this.socket||(_this.socket=(0,socket_io_client__WEBPACK_IMPORTED_MODULE_2__.ZP)(constants_resources__WEBPACK_IMPORTED_MODULE_3__.gs,{path:"/back/socket",transports:["websocket","polling"]}),_this.socket.on("connect",(function(socket){_services_NotificationService__WEBPACK_IMPORTED_MODULE_11__.O.registerWidgetSocket(_this.socket)})),_this.socket.on("RECEIVE_NOTIFICATION",(function(notification){_services_NotificationService__WEBPACK_IMPORTED_MODULE_11__.O.isWidgetRegistredInSocketPool(notification.widgetSocketId)||_services_NotificationService__WEBPACK_IMPORTED_MODULE_11__.O.sendNotification(notification.widgetNotification)}))),_this}return(0,_Users_lidrissi_Documents_um6p_dbr_ui_node_modules_babel_runtime_helpers_esm_createClass_js__WEBPACK_IMPORTED_MODULE_19__.Z)(GenericWidget,[{key:"setDashboardId",value:function setDashboardId(){}},{key:"renderWidget",value:function renderWidget(widgetNotification){if(widgetNotification&&null!=widgetNotification)try{if(this.props.widget.config=this.jsonParser(this.props.widget.config),this.props.widget.config.hasOwnProperty("render")){var render=eval(this.props.widget.config.render),renderParams={chart:this.chart,props:this.props,notification:widgetNotification,am4core:_amcharts_amcharts4_core__WEBPACK_IMPORTED_MODULE_5__,am4charts:_amcharts_amcharts4_charts__WEBPACK_IMPORTED_MODULE_6__,worldMoroccoLow:_amcharts_amcharts4_geodata_worldMoroccoLow__WEBPACK_IMPORTED_MODULE_9__.Z,moroccoLow:_amcharts_amcharts4_geodata_moroccoLow__WEBPACK_IMPORTED_MODULE_10__.Z,am4maps:_amcharts_amcharts4_maps__WEBPACK_IMPORTED_MODULE_8__,am4plugins_wordCloud:_amcharts_amcharts4_plugins_wordCloud__WEBPACK_IMPORTED_MODULE_7__};this.chart=render(renderParams),this.chart.dispatchEvent=this.dispathWidgetEvent.bind(this)}}catch(er){console.log(er)}}},{key:"notifyAllWidgets",value:function notifyAllWidgets(widgetNotification){_services_NotificationService__WEBPACK_IMPORTED_MODULE_11__.O.sendNotification(widgetNotification),this.socket.emit("SEND_NOTIFICATION",{widgetSocketId:this.socket.id,widgetNotification:widgetNotification})}},{key:"dispathWidgetEvent",value:function dispathWidgetEvent(widgetParam){if(this.mappingParams&&0!=this.mappingParams.length){var widgetNotification={fromWidgetKey:this.props.widget._id,appParamsValue:{}};this.mappingParams.forEach((function(item){widgetNotification.appParamsValue[item.appParam]=widgetParam[item.responseParam]})),this.notifyAllWidgets(widgetNotification)}}},{key:"componentDidMount",value:function componentDidMount(){this.initializeWidget(),this.props.exportChart.current=this.exportChart,this.props.initChart.current=this.initializeWidget}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.subscription&&this.subscription.unsubscribe()}},{key:"jsonParser",value:function jsonParser(toParse){var parsed=toParse;return"string"==typeof toParse&&(parsed=JSON.parse(toParse)),"string"==typeof parsed?this.jsonParser(parsed):parsed}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps){this.props.widget.data!=prevProps.widget.data&&this.renderWidget({appParamsValue:this.lastAppParams})}},{key:"render",value:function render(){var _this$props$widget,_this$props$widget$da;return(0,react_jsx_runtime__WEBPACK_IMPORTED_MODULE_12__.jsx)("div",{id:this.props.widget._id,className:"w-100 h-100 ".concat((null===(_this$props$widget=this.props.widget)||void 0===_this$props$widget||null===(_this$props$widget$da=_this$props$widget.data)||void 0===_this$props$widget$da?void 0:_this$props$widget$da.length)>0?"":"d-none")},this.props.widget._id)}}]),GenericWidget}(react__WEBPACK_IMPORTED_MODULE_1__.PureComponent);GenericWidget.__docgenInfo={description:"",methods:[{name:"handleNotification",docblock:null,modifiers:[],params:[{name:"widgetNotification",type:null}],returns:null},{name:"setDashboardId",docblock:null,modifiers:[],params:[],returns:null},{name:"renderWidget",docblock:null,modifiers:[],params:[{name:"widgetNotification",type:null}],returns:null},{name:"notifyAllWidgets",docblock:null,modifiers:[],params:[{name:"widgetNotification",type:null}],returns:null},{name:"dispathWidgetEvent",docblock:null,modifiers:[],params:[{name:"widgetParam",type:null}],returns:null},{name:"exportChart",docblock:null,modifiers:[],params:[{name:"type",type:null}],returns:null},{name:"jsonParser",docblock:null,modifiers:[],params:[{name:"toParse",type:null}],returns:null},{name:"initializeWidget",docblock:null,modifiers:["async"],params:[],returns:null}],displayName:"GenericWidget"},__webpack_exports__.default=GenericWidget,"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/Widget/GenericWidget/GenericWidget.jsx"]={name:"GenericWidget",docgenInfo:GenericWidget.__docgenInfo,path:"src/components/Widget/GenericWidget/GenericWidget.jsx"})}}]);