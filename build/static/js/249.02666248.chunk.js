"use strict";(self.webpackChunkdbr_ui=self.webpackChunkdbr_ui||[]).push([[249],{44249:function(t,e,i){i.r(e);var n=i(72791),a=i(40807),o=i(87901),r=i(72525),u=i(36199);e.default=function(t){var e,i,d,c,f=t.widgetId,s=t.treeId,l=(0,n.useContext)(u.h),p=l.map,m=l.dashboard.widgets,v=l.setMapData,g=s||f,I=(null===(e=p[g])||void 0===e?void 0:e.currentNodeId)||null,k=(null===(i=p[g])||void 0===i?void 0:i.data)||[];(0,n.useEffect)((function(){return d=r.O.getNotification().subscribe((function(t){N(m,t,k)})),b(),function(){d&&d.unsubscribe()}}),[k,m]),(0,n.useEffect)((function(){var t;if(I){var e=k.find((function(t){var e=t._id;return I==e}));if(e){var i={};for(var n in e.metaData||{})i[n]=e.metaData[n]+"".split(",").map((function(t){return t.trim()}))[0];e.applicationParam&&(i[e.applicationParam]=e.name),!((null===(t=Object.keys(i))||void 0===t?void 0:t.length)>0)||s&&m[s]||O({fromWidgetKey:f,appParamsValue:i})}}}),[I]);var b=function(t){return(c=(0,o.ZP)(a.gs,{path:"/back/socket",transports:["websocket","polling"]})).on("connect",(function(){r.O.registerWidgetSocket(c)})),c.on("RECEIVE_NOTIFICATION",(function(e){e.widgetSocketId!=c.id&&(r.O.isWidgetRegistredInSocketPool(e.widgetSocketId)||N(t,e.widgetNotification,k))})),c},N=function(t,e,i){if(!(t&&s&&t[s])&&e.appParamsValue&&e.fromWidgetKey!=f){var n=e.appParamsValue,a=i.filter((function(t){var e=Object.keys(n).filter((function(e){return t.metaData&&t.metaData[e]}));return(null===e||void 0===e?void 0:e.length)>0&&e.every((function(e){return t.metaData[e]&&(""==n[e]||t.metaData[e].split(",").map((function(t){return t.trim()})).indexOf(n[e]+"")>-1)}))}));(null===a||void 0===a?void 0:a.length)>0&&v(s||f,{currentNodeId:1==a.length?a[0]._id:"root",mapNodes:a,nodes:a})}},O=function(t){r.O.sendNotification(t),c||(c=b(m)),c.emit("SEND_NOTIFICATION",{widgetSocketId:c.id,widgetNotification:t})};return{currentNodeId:I,notification:!0}}}}]);
//# sourceMappingURL=249.02666248.chunk.js.map