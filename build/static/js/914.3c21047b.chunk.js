"use strict";(self.webpackChunkdbr_ui=self.webpackChunkdbr_ui||[]).push([[914,825,42,858,190,249],{75646:function(e,n,t){t.d(n,{z:function(){return o}});t(83757);var a=t(94677),r=t(40807);function o(e){var n={method:r.lD.nodes.get.method,url:"".concat((0,r.kG)(),"/").concat(r.lD.nodes.get.resource,"?widget=").concat(e)};return(0,a.Z)(n).then((function(e){return e.data})).catch((function(e){return e}))}},21825:function(e,n,t){t.r(n);var a=t(70885),r=t(72791),o=t(80184);n.default=function(e){var n=(0,r.useState)(!1),t=(0,a.Z)(n,2),i=t[0],c=t[1],d=e.selectPrevMatch,s=e.selectNextMatch,u=e.searchFocusIndex,l=e.searchFoundCount,f=e.onSearchChange,h=e.searchString,v=function(){return(0,o.jsx)("span",{className:"search-box__icon",onClick:function(){return c(!i)},children:(0,o.jsx)("i",{className:"simple-icon-magnifier"})})};return(0,o.jsx)(o.Fragment,{children:i?(0,o.jsxs)("div",{className:"search-box",children:[(0,o.jsx)(v,{}),(0,o.jsx)("input",{value:h,onChange:function(e){return f(e.target.value)}}),(null===h||void 0===h?void 0:h.length)>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:"search-box__count m-1",children:[l>0?u+1:0," / ",l]}),(0,o.jsxs)("div",{className:"search-box__controls m-1",children:[(0,o.jsx)("span",{onClick:d,children:(0,o.jsx)("i",{className:"simple-icon-arrow-up"})}),(0,o.jsx)("span",{onClick:s,className:"m-1",children:(0,o.jsx)("i",{className:"simple-icon-arrow-down"})})]})]})]}):(0,o.jsx)(v,{})})}},51986:function(e,n,t){t.r(n);var a=t(70885),r=t(72791),o=t(89855),i=(t(51190),t(80184));n.default=function(e){var n,t=(0,r.useState)([]),c=(0,a.Z)(t,2),d=c[0],s=c[1],u=(null===(n=e.widget)||void 0===n?void 0:n._id)||"";return(0,i.jsx)(o.default,{setTreeData:s,treeData:d,onEditNode:function(){},onAddNode:function(){},onRemoveNode:function(){},onMoveNode:function(){},widgetId:u})}},89855:function(e,n,t){t.r(n),t.d(n,{default:function(){return v}});var a=t(42982),r=t(70885),o=t(72791),i=t(30774),c=(t(16807),t(1413));var d=t(21825),s=t(44249),u=t(75646),l=t(36199),f=t(80184),h=o.memo((function(e){var n=(0,s.default)({widgetId:e.widgetId}).currentNodeId,t=(0,o.useContext)(l.h).setMapData,h=(0,o.useState)(""),v=(0,r.Z)(h,2),g=v[0],m=v[1],p=(0,o.useState)(0),N=(0,r.Z)(p,2),x=N[0],w=N[1],I=(0,o.useState)(null),_=(0,r.Z)(I,2),D=_[0],j=_[1],C=(0,o.useState)([]),k=(0,r.Z)(C,2),b=k[0],S=k[1],O=e.treeData,P=(e.onAddNode,e.setTreeData),y=e.onMoveNode;(0,o.useEffect)((function(){(0,u.z)(e.widgetId).then((function(e){var n=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e||e.length<1)return[];var t={};e.forEach((function(e){var a,r;e.roles&&0!=e.roles.length&&!e.roles.some((function(e){return n.indexOf(e)>-1}))||(t[e._id]=(0,c.Z)((0,c.Z)({},e),{},{lat:null===(a=e.location)||void 0===a?void 0:a.coordinates[1],lng:null===(r=e.location)||void 0===r?void 0:r.coordinates[0],children:e.children||[]}))}));var a=[];Object.keys(t).forEach((function(e,n){if(t&&t.hasOwnProperty(e)){var r=t[e];r.parent&&t[r.parent]?t[r.parent].children.push(r):a.push(r)}}));for(var r=0;r<a.length;r++)a[r].isRoot=!0;return a}(e,[]);P(n)}))}),[]),(0,o.useEffect)((function(){var e,t=(0,i.sE)({getNodeKey:M,treeData:O,searchQuery:n,searchMethod:function(e){var n=e.node,t=e.searchQuery;return n._id==t},searchFocusOffset:0,expandAllMatchPaths:!0,expandFocusMatchPaths:!0});(null===(e=t.treeData)||void 0===e?void 0:e.length)>0&&P(t.treeData)}),[n]);var M=function(e){return e.treeIndex},F=(0,i.vr)({treeData:O});return(0,f.jsxs)("div",{className:"wrapper",children:[(0,f.jsx)("div",{className:"d-flex justify-content-end align-items-center",children:(0,f.jsx)(d.default,{searchString:g,selectPrevMatch:function(){w(null!==x?(D+x-1)%D:D-1)},selectNextMatch:function(){w(null!==x?(x+1)%D:0)},searchFocusIndex:x,searchFoundCount:D,onSearchChange:m})}),(0,f.jsx)("div",{className:"tree-wrapper",children:(0,f.jsx)(i.ZP,{onMoveNode:function(e){var n=e.node,t=e.nextParentNode,a=e.path;y({node:n,nextParentNode:t,path:a,prevTreeData:b})},onDragStateChanged:function(e){e.isDragging&&S(O)},treeData:O,onChange:P,rowHeight:55,canDrag:!1,canDrop:function(e){var n=e.nextParent;return!n||!n.noChildren},searchQuery:g,style:{height:55*F+20},searchFocusOffset:x,searchFinishCallback:function(e){j(e.length),w(e.length>0?x%e.length:0)},isVirtualized:!0,searchMethod:function(e){var n=e.node,t=e.searchQuery;return t&&n.name&&n.name.toLowerCase().indexOf(t.toLowerCase())>-1},generateNodeProps:function(r){return{title:"".concat(r.node.name),onClick:function(n){return function(n,r){var o,i,c,d=n.target.className;if("rst__expandButton"!=d&&"rst__collapseButton"!=d){var s=[].concat((0,a.Z)((null===(o=r.children)||void 0===o?void 0:o.length)>0&&0==(null===(i=r.polygonCoordinates)||void 0===i?void 0:i.length)?[]:[r]),(0,a.Z)((null===(c=r.children)||void 0===c?void 0:c.length)>0?r.children:[]));s&&0!=s.length&&(console.log("node id",r._id),t(e.widgetId,{currentNodeId:r._id,nodes:s,mapNodes:s}))}}(n,r.node)},className:n==r.node._id?"rst__rowSearchMatch rst__rowSearchFocus":""}}})})]})})),v=h},11438:function(e,n,t){t.r(n);var a=t(51986);n.default=a.default},44249:function(e,n,t){t.r(n);var a=t(72791),r=t(40807),o=t(87901),i=t(72525),c=t(36199);n.default=function(e){var n,t,d,s,u=e.widgetId,l=e.treeId,f=(0,a.useContext)(c.h),h=f.map,v=f.dashboard.widgets,g=f.setMapData,m=l||u,p=(null===(n=h[m])||void 0===n?void 0:n.currentNodeId)||null,N=(null===(t=h[m])||void 0===t?void 0:t.data)||[];(0,a.useEffect)((function(){return d=i.O.getNotification().subscribe((function(e){w(v,e,N)})),x(),function(){d&&d.unsubscribe()}}),[N,v]),(0,a.useEffect)((function(){var e;if(p){var n=N.find((function(e){var n=e._id;return p==n}));if(n){var t={};for(var a in n.metaData||{})t[a]=n.metaData[a]+"".split(",").map((function(e){return e.trim()}))[0];n.applicationParam&&(t[n.applicationParam]=n.name),!((null===(e=Object.keys(t))||void 0===e?void 0:e.length)>0)||l&&v[l]||I({fromWidgetKey:u,appParamsValue:t})}}}),[p]);var x=function(e){return(s=(0,o.ZP)(r.gs,{path:"/back/socket",transports:["websocket","polling"]})).on("connect",(function(){i.O.registerWidgetSocket(s)})),s.on("RECEIVE_NOTIFICATION",(function(n){n.widgetSocketId!=s.id&&(i.O.isWidgetRegistredInSocketPool(n.widgetSocketId)||w(e,n.widgetNotification,N))})),s},w=function(e,n,t){if(!(e&&l&&e[l])&&n.appParamsValue&&n.fromWidgetKey!=u){var a=n.appParamsValue,r=t.filter((function(e){var n=Object.keys(a).filter((function(n){return e.metaData&&e.metaData[n]}));return(null===n||void 0===n?void 0:n.length)>0&&n.every((function(n){return e.metaData[n]&&(""==a[n]||e.metaData[n].split(",").map((function(e){return e.trim()})).indexOf(a[n]+"")>-1)}))}));(null===r||void 0===r?void 0:r.length)>0&&g(l||u,{currentNodeId:1==r.length?r[0]._id:"root",mapNodes:r,nodes:r})}},I=function(e){i.O.sendNotification(e),s||(s=x(v)),s.emit("SEND_NOTIFICATION",{widgetSocketId:s.id,widgetNotification:e})};return{currentNodeId:p,notification:!0}}},51190:function(e,n,t){t.r(n),n.default={}}}]);
//# sourceMappingURL=914.3c21047b.chunk.js.map