"use strict";(self.webpackChunkdbr_ui=self.webpackChunkdbr_ui||[]).push([[858,825,249],{75646:function(e,n,t){t.d(n,{z:function(){return o}});t(83757);var a=t(94677),r=t(40807);function o(e){var n={method:r.lD.nodes.get.method,url:"".concat((0,r.kG)(),"/").concat(r.lD.nodes.get.resource,"?widget=").concat(e)};return(0,a.Z)(n).then((function(e){return e.data})).catch((function(e){return e}))}},21825:function(e,n,t){t.r(n);var a=t(70885),r=t(72791),o=t(80184);n.default=function(e){var n=(0,r.useState)(!1),t=(0,a.Z)(n,2),i=t[0],c=t[1],s=e.selectPrevMatch,d=e.selectNextMatch,u=e.searchFocusIndex,l=e.searchFoundCount,h=e.onSearchChange,f=e.searchString,v=function(){return(0,o.jsx)("span",{className:"search-box__icon",onClick:function(){return c(!i)},children:(0,o.jsx)("i",{className:"simple-icon-magnifier"})})};return(0,o.jsx)(o.Fragment,{children:i?(0,o.jsxs)("div",{className:"search-box",children:[(0,o.jsx)(v,{}),(0,o.jsx)("input",{value:f,onChange:function(e){return h(e.target.value)}}),(null===f||void 0===f?void 0:f.length)>0&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("span",{className:"search-box__count m-1",children:[l>0?u+1:0," / ",l]}),(0,o.jsxs)("div",{className:"search-box__controls m-1",children:[(0,o.jsx)("span",{onClick:s,children:(0,o.jsx)("i",{className:"simple-icon-arrow-up"})}),(0,o.jsx)("span",{onClick:d,className:"m-1",children:(0,o.jsx)("i",{className:"simple-icon-arrow-down"})})]})]})]}):(0,o.jsx)(v,{})})}},89855:function(e,n,t){t.r(n),t.d(n,{default:function(){return v}});var a=t(42982),r=t(70885),o=t(72791),i=t(30774),c=(t(16807),t(1413));var s=t(21825),d=t(44249),u=t(75646),l=t(36199),h=t(80184),f=o.memo((function(e){var n=(0,d.default)({widgetId:e.widgetId}).currentNodeId,t=(0,o.useContext)(l.h).setMapData,f=(0,o.useState)(""),v=(0,r.Z)(f,2),g=v[0],p=v[1],m=(0,o.useState)(0),x=(0,r.Z)(m,2),N=x[0],w=x[1],I=(0,o.useState)(null),_=(0,r.Z)(I,2),j=_[0],C=_[1],D=(0,o.useState)([]),k=(0,r.Z)(D,2),b=k[0],S=k[1],O=e.treeData,P=(e.onAddNode,e.setTreeData),y=e.onMoveNode;(0,o.useEffect)((function(){(0,u.z)(e.widgetId).then((function(e){var n=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e||e.length<1)return[];var t={};e.forEach((function(e){var a,r;e.roles&&0!=e.roles.length&&!e.roles.some((function(e){return n.indexOf(e)>-1}))||(t[e._id]=(0,c.Z)((0,c.Z)({},e),{},{lat:null===(a=e.location)||void 0===a?void 0:a.coordinates[1],lng:null===(r=e.location)||void 0===r?void 0:r.coordinates[0],children:e.children||[]}))}));var a=[];Object.keys(t).forEach((function(e,n){if(t&&t.hasOwnProperty(e)){var r=t[e];r.parent&&t[r.parent]?t[r.parent].children.push(r):a.push(r)}}));for(var r=0;r<a.length;r++)a[r].isRoot=!0;return a}(e,[]);P(n)}))}),[]),(0,o.useEffect)((function(){var e,t=(0,i.sE)({getNodeKey:F,treeData:O,searchQuery:n,searchMethod:function(e){var n=e.node,t=e.searchQuery;return n._id==t},searchFocusOffset:0,expandAllMatchPaths:!0,expandFocusMatchPaths:!0});(null===(e=t.treeData)||void 0===e?void 0:e.length)>0&&P(t.treeData)}),[n]);var F=function(e){return e.treeIndex},M=(0,i.vr)({treeData:O});return(0,h.jsxs)("div",{className:"wrapper",children:[(0,h.jsx)("div",{className:"d-flex justify-content-end align-items-center",children:(0,h.jsx)(s.default,{searchString:g,selectPrevMatch:function(){w(null!==N?(j+N-1)%j:j-1)},selectNextMatch:function(){w(null!==N?(N+1)%j:0)},searchFocusIndex:N,searchFoundCount:j,onSearchChange:p})}),(0,h.jsx)("div",{className:"tree-wrapper",children:(0,h.jsx)(i.ZP,{onMoveNode:function(e){var n=e.node,t=e.nextParentNode,a=e.path;y({node:n,nextParentNode:t,path:a,prevTreeData:b})},onDragStateChanged:function(e){e.isDragging&&S(O)},treeData:O,onChange:P,rowHeight:55,canDrag:!1,canDrop:function(e){var n=e.nextParent;return!n||!n.noChildren},searchQuery:g,style:{height:55*M+20},searchFocusOffset:N,searchFinishCallback:function(e){C(e.length),w(e.length>0?N%e.length:0)},isVirtualized:!0,searchMethod:function(e){var n=e.node,t=e.searchQuery;return t&&n.name&&n.name.toLowerCase().indexOf(t.toLowerCase())>-1},generateNodeProps:function(r){return{title:"".concat(r.node.name),onClick:function(n){return function(n,r){var o,i,c,s=n.target.className;if("rst__expandButton"!=s&&"rst__collapseButton"!=s){var d=[].concat((0,a.Z)((null===(o=r.children)||void 0===o?void 0:o.length)>0&&0==(null===(i=r.polygonCoordinates)||void 0===i?void 0:i.length)?[]:[r]),(0,a.Z)((null===(c=r.children)||void 0===c?void 0:c.length)>0?r.children:[]));d&&0!=d.length&&(console.log("node id",r._id),t(e.widgetId,{currentNodeId:r._id,nodes:d,mapNodes:d}))}}(n,r.node)},className:n==r.node._id?"rst__rowSearchMatch rst__rowSearchFocus":""}}})})]})})),v=f},44249:function(e,n,t){t.r(n);var a=t(72791),r=t(40807),o=t(87901),i=t(72525),c=t(36199);n.default=function(e){var n,t,s,d,u=e.widgetId,l=e.treeId,h=(0,a.useContext)(c.h),f=h.map,v=h.dashboard.widgets,g=h.setMapData,p=l||u,m=(null===(n=f[p])||void 0===n?void 0:n.currentNodeId)||null,x=(null===(t=f[p])||void 0===t?void 0:t.data)||[];(0,a.useEffect)((function(){return s=i.O.getNotification().subscribe((function(e){w(v,e,x)})),N(),function(){s&&s.unsubscribe()}}),[x,v]),(0,a.useEffect)((function(){var e;if(m){var n=x.find((function(e){var n=e._id;return m==n}));if(n){var t={};for(var a in n.metaData||{})t[a]=n.metaData[a]+"".split(",").map((function(e){return e.trim()}))[0];n.applicationParam&&(t[n.applicationParam]=n.name),!((null===(e=Object.keys(t))||void 0===e?void 0:e.length)>0)||l&&v[l]||I({fromWidgetKey:u,appParamsValue:t})}}}),[m]);var N=function(e){return(d=(0,o.ZP)(r.gs,{path:"/back/socket",transports:["websocket","polling"]})).on("connect",(function(){i.O.registerWidgetSocket(d)})),d.on("RECEIVE_NOTIFICATION",(function(n){n.widgetSocketId!=d.id&&(i.O.isWidgetRegistredInSocketPool(n.widgetSocketId)||w(e,n.widgetNotification,x))})),d},w=function(e,n,t){if(!(e&&l&&e[l])&&n.appParamsValue&&n.fromWidgetKey!=u){var a=n.appParamsValue,r=t.filter((function(e){var n=Object.keys(a).filter((function(n){return e.metaData&&e.metaData[n]}));return(null===n||void 0===n?void 0:n.length)>0&&n.every((function(n){return e.metaData[n]&&(""==a[n]||e.metaData[n].split(",").map((function(e){return e.trim()})).indexOf(a[n]+"")>-1)}))}));(null===r||void 0===r?void 0:r.length)>0&&g(l||u,{currentNodeId:1==r.length?r[0]._id:"root",mapNodes:r,nodes:r})}},I=function(e){i.O.sendNotification(e),d||(d=N(v)),d.emit("SEND_NOTIFICATION",{widgetSocketId:d.id,widgetNotification:e})};return{currentNodeId:m,notification:!0}}}}]);
//# sourceMappingURL=858.76a37fec.chunk.js.map